<!DOCTYPE html>
<html>

<head>
    <!-- skapad utifrån http://www.jessicaschillinger.us/2017/blog/print-repeating-header-browser/ -->
    <title>Planeringsunderlag försäljning</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>

    <!-- Load Esri Leaflet from CDN.  it has no .css stylesheet of its own, only .js -->
    <script src="https://unpkg.com/esri-leaflet@2.0.4/dist/esri-leaflet.js"></script>

    <!-- Laddar proj4 -->
    <script src="https://unpkg.com/proj4@2.4.3"></script>
    <script src="https://unpkg.com/proj4leaflet@1.0.1"></script>



    <!-- 
    <script src="lib/leaflet.label.js"></script>
    <script type="text/javascript" src="Data/symbologi.json"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ" crossorigin="anonymous">
    -->

    <style type="text/css">
        #mapid {
            height: 800px;
        }

        .label {
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            margin-top: -1em;
        }

        .label div {
            position: relative;
            left: -50%;
            text-shadow: 0px 2px 1px rgba(255, 255, 255, 0.85);
        }

        .map-marker {
            text-align: center;
            position: absolute;
            overflow: hidden;
            background-repeat: no-repeat;
            background-position: center;
            color: #fff;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            line-height: 22pt;
            font-size: 22px;
            font-family: 'sans-serif';
            
        }


        .map-marker.marker-color-fastighet-yl {
            background: white;
            color: black;
        }

        .map-marker.marker-color-byggnad {
            background: #55ff00;
        }

        .map-marker.marker-color-tomt {
            background: #734c00;
        }
        .map-marker.marker-color-tomt-yl {
            background: white;
            color: #734c00;
        }

        .map-marker.marker-color-belastning {
            background: #e69900;
        }

        .map-marker.marker-color-belastning-yl {
            background: white;
            color: #e69900;
        }

        .map-marker.marker-color-rattighet {
            background: #00c5ff;
        }

        .map-marker.marker-color-rattighet-yl {
            background: white;
            color: #00c5ff;
        }
    </style>
</head>

<body>



    <div class="container">
        <div class="row pgaBreak" id="kartsida_3">
            <div class="col-12">
                <!--<div class="jumbotron">-->
                <div>
                    <div>
                        <img src="https://www.sveaskog.se/static/dist/img/sveaskog-logo.svg" alt="Sveaskog" style="padding:5px;" width="200px" align="left">
                    </div>
                    <div>
                        <h1 align="center">Underlag försäljning</h1>
                        <p align="center">Kartbilaga<span class="step"> 1</span></p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                            <p id="northWest" align="left">xkoord</p>   
                    </div>
                    <div class="col-6">
                            <p id="northEast" align="right">xkoord</p>
                    </div>
                </div>

                <div calss="row">
                    <div id="mapid"></div>
                </div>

                <div class="row">
                    <div class="col-4">
                            <p id="southWest" align="left">xkoord</p>
                    </div>
                    <div class="col-4">
                            <p align="center">Sweref99</p>
                    </div>
                    <div class="col-4">
                            <p id="southEast" align="right">xkoord</p>
                    </div>
                    
                </div>

                <div calss="row">
                    <div id="legend">
                            <h6 class="text-center">Teckenförklaring</h6>
                            <svg height="100" width="100%">
                                <text x="10" y="15" style="font-family: sans-serif; font-size: 16px; font-style: oblique">Linje</text>
                                <text x="100" y="15" style="font-family: sans-serif; font-size: 16px; font-style: oblique">Yta</text>
                                <text x="150" y="15" style="font-family: sans-serif; font-size: 16px; font-style: oblique">Punkt</text>
                                <text x="200" y="15" style="font-family: sans-serif; font-size: 16px; font-style: oblique">Typ</text>
        
                                <line x1="10" y1="30" x2="80" y2="30" style="stroke:#e69900; stroke-width: 2; stroke-dasharray: 20, 5, 10, 5" ></line>
                                <rect x="100" y="25" width="30" height="10" style="fill:#e69900;stroke:pink;stroke-width:1;fill-opacity:0.9;stroke-opacity:0.9" ></rect>
                                <circle cx="170" cy="30" r="10" stroke="white" stroke-width="3" fill="#e69900" ></circle>
                                <text x="167" y="33" style="font-family: sans-serif; font-size: 12px; stroke: #fff">3</text>
                                <text x="200" y="35" style="font-family: sans-serif; font-size: 16px;">Belastning</text>
        
                                <line x1="10" y1="50" x2="80" y2="50" style="stroke:#00c5ff; stroke-width: 2; stroke-dasharray: 20, 5, 10, 5" ></line>
                                <rect x="100" y="45" width="30" height="10" style="fill:#00c5ff;stroke:pink;stroke-width:1;fill-opacity:0.9;stroke-opacity:0.9" ></rect>
                                <circle cx="170" cy="50" r="10" stroke="white" stroke-width="3" fill="#00c5ff" ></circle>
                                <text x="167" y="53" style="font-family: sans-serif; font-size: 12px; stroke: #fff">3</text>
                                <text x="200" y="55" style="font-family: sans-serif; font-size: 16px;">Rättighet</text>

                                <!--<line x1="10" y1="70" x2="80" y2="70" style="stroke:#00c5ff; stroke-width: 2; stroke-dasharray: 20, 5, 10, 5" ></line>-->
                                <rect x="100" y="65" width="30" height="10" style="fill:#990099;stroke:pink;stroke-width:1;fill-opacity:0.9;stroke-opacity:0.9" ></rect>
                                <!--<circle cx="170" cy="70" r="10" stroke="white" stroke-width="3" fill="#990099" ></circle>
                                <text x="167" y="73" style="font-family: sans-serif; font-size: 12px; stroke: #fff">3</text>-->
                                <text x="200" y="75" style="font-family: sans-serif; font-size: 16px;">Jaktupplåtelse</text>
                            </svg>
        
                    </div>
                </div>
                <div class="row">
                        <div class="col-12">
                            <h6 align="center">Berörda objekt</h6>
                        </div>
                        <!--<p><button onclick="sortTables()">Sortera alla tabeller</button></p>-->
                        
                            <table class="table-striped table-bordered" id="Tabell">
                                <tr>
                                    <th onclick="sortTable(0, Tabell)">Löpnummer</th>
                                    <th onclick="sortTable(1, Tabell)">Lager</th>
                                    <th onclick="sortTable(2, Tabell)">Benämning</th>
                                    <th onclick="sortTable(3, Tabell)">YLP</th>
                                </tr>

                            </table>
                        
                    </div>
                <div calss="row">
                        <div id="karobjekt">

                        </div>
                </div>
                
            </div>
        </div>

    </div>





    <script>

        //var overlatelseID = 142401;
        var overlatelseID = getQueryVariable("id");

        var crs = new L.Proj.CRS('EPSG:3006',
            '+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',
            {
                resolutions: [
                    8192, 4096, 2048, 1024, 512, 256, 128,
                    64, 32, 16, 8, 4, 2, 1, 0.5
                ],
                origin: [0, 0],
                bounds: L.bounds([218128.7031, 6126002.9379], [1083427.2970, 7692850.9468])
            }),
            map = new L.Map('mapid', {
                crs: crs,
            });

        map.setView([62.0, 15.0], 2);

        map.createPane('overlatelse');
        map.getPane('overlatelse').style.zIndex = 490;
        map.createPane('tomt');
        map.getPane('tomt').style.zIndex = 470;


        //----------------- OpenStreetMap ---------------------
        var osm = L.tileLayer('https://api.geosition.com/tile/osm-bright-3006/{z}/{x}/{y}.png', {
            maxZoom: 14,
            minZoom: 0,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, Imagery &copy; <a href="http://www.kartena.se/">Kartena</a>'
        }).addTo(map);

        //--------------------------------------------- Metria maps skarp ----------------------------
        var wmsMetriaBakgrundLayer = L.tileLayer.wms('https://kartportaltest.sveaskog.se/tokenproxy/metria/wms?', {
            layers: 'MetriaFastighetSkarp',
            //opacity : 0.25,
            maxZoom: 14
        });//.addTo(map);


        //----------------------------- ortofoto från Metria via tokenproxy ---------------------
        var wmsOrtoLayer = L.tileLayer.wms('https://kartportaltest.sveaskog.se/tokenproxy/metria/wms?', {
            layers: 'metria:orto_farg',
            //opacity : 0.25,
            maxZoom: 14
        });//.addTo(map);

        //----------------------------- Fastigheter från Metria via tokenproxy ---------------------
        var wmsFstLayer = L.tileLayer.wms('https://kartportaltest.sveaskog.se/tokenproxy/metria/wms?', {
            layers: 'metria:FastighetsytorGranser_FK',
            //opacity : 0.25,
            maxZoom: 14,
            transparent: true,
            format: 'image/png'
        });//.addTo(map);

        //----------------Fastighet från analysen----------------
        var fastighetYtaMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/9',
            where: "OverlatelseID = " + overlatelseID,
            style: fastighetMapStyle(this),

        });//.addTo(map);

        var fastighetYtaLabels = {};

        fastighetYtaMapLayer.on('createfeature', function (e) {
            var id = e.feature.id;
            var feature = fastighetYtaMapLayer.getFeature(id);
            //console.log(feature);
            //console.log(feature.feature.properties.lopnummer);
            var center = feature.getBounds().getCenter();
            var label = L.marker(center, {
                icon: L.divIcon({
                    iconSize: null,
                    //position: 'relative',
                    //left: '-50%',
                    className: 'map-marker marker-color-fastighet-yl',
                    html: '<div>' + feature.feature.properties.lopnummer + '</div>'
                })
            }).addTo(map);
            fastighetYtaLabels[id] = label;
        });

        fastighetYtaMapLayer.on('addfeature', function (e) {
            var label = fastighetYtaLabels[e.feature.id];
            if (label) {
                label.addTo(map);
            }
        });

        fastighetYtaMapLayer.on('removefeature', function (e) {
            var label = fastighetYtaLabels[e.feature.id];
            if (label) {
                map.removeLayer(label);
            }
        });

        //---------------------------------- Överlåtelsen ------------------------------------
        var overlatelseMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/8',
            where: "OverlatelseID = " + overlatelseID,
            style: overlatelseMapStyle(this),
            pane: 'overlatelse',
        }).addTo(map);


        // ------------------------- Avdelning -----------------------------
        var agoslagMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljningAvd/MapServer/1',
            where: "OverlatelseID = " + overlatelseID,
            style: agoslagMapStyle(this),
        });//.addTo(map);

        //---------------------------------- Lable lager ------------------------------------
        //----------------Lable Punkt-------------
        var lableMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/12',
            where: "OverlatelseID = " + overlatelseID,
            pointToLayer: function (geojson, latlng) {
                //console.log(latlng);
                //console.log(geojson);
                //console.log(geojson.properties);
                label = String(geojson.properties.lopnummer)
                return L.marker(latlng, {
                    icon: L.divIcon({
                        iconSize: null,
                        className: 'map-marker marker-color-belastning',
                        html: '<div>' + label + '</div>'
                        
                    })
                })
            },
            


        });//.addTo(map);

        var queryAll = L.esri.query({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/12'
        });

        console.log(queryAll);

        //---------------- skapar tabellen----------------------
        lableMapLayer.on('createfeature', function (e) {
            var id = e.feature.id;
            var feature = lableMapLayer.getFeature(id);
            console.log(feature);
            
            properties = feature.feature.properties;
            addToTabell(properties, "lable", "P");
            sortTables();

        });

       console.log(lableMapLayer)

        //---------------------------------- rättighet ------------------------------------
        //----------------rättighet Punkt-------------
        var rattighetPunktMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/1',
            where: "OverlatelseID = " + overlatelseID,
            pointToLayer: function (geojson, latlng) {
                //console.log(latlng);
                //console.log(geojson);
                //console.log(geojson.properties);
                label = String(geojson.properties.lopnummer)
                return L.marker(latlng, {
                    icon: L.divIcon({
                        iconSize: null,
                        className: 'map-marker marker-color-rattighet',
                        html: '<div>' + label + '</div>'
                    })
                })
            },
        });//.addTo(map);        

        //----------------rättighet Yta----------------
        var rattighetYtaMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/7',
            where: "OverlatelseID = " + overlatelseID,
            style: rattighetMapStyle(this),

        });//.addTo(map);


        //----------------rättighet Linje----------------
        var ratighetLinjeMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/4',
            where: "OverlatelseID = " + overlatelseID,
            style: rattighetMapStyle(this),

        });//.addTo(map);


        //---------------------------------- byggnad ------------------------------------
        //----------------byggnad Punkt-------------
        var byggnadPunktMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/2',
            where: "OverlatelseID = " + overlatelseID,
            pointToLayer: function (geojson, latlng) {
                //console.log(latlng);
                //console.log(geojson);
                //console.log(geojson.properties);
                label = String(geojson.properties.lopnummer)
                return L.marker(latlng, {
                    icon: L.divIcon({
                        iconSize: null,
                        className: 'map-marker marker-color-byggnad',
                        html: '<div>' + label + '</div>'
                    })
                })
            },
        });//.addTo(map);

        //---------------------------------- belastning ------------------------------------
        //----------------belastning Punkt-------------
        var belastingPunktMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/3',
            where: "OverlatelseID = " + overlatelseID,
            pointToLayer: function (geojson, latlng) {
                //console.log(latlng);
                //console.log(geojson);
                //console.log(geojson.properties);
                label = String(geojson.properties.lopnummer)
                return L.marker(latlng, {
                    icon: L.divIcon({
                        iconSize: null,
                        className: 'map-marker marker-color-belastning',
                        html: '<div>' + label + '</div>'
                        
                    })
                })
            },
        });//.addTo(map);
        

        //----------------belastning Yta----------------
        var belastningYtaMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/10',
            where: "OverlatelseID = " + overlatelseID,
            style: belastningMapStyle(this),

        });//.addTo(map);

        //----------------belastning Linje----------------
        var belastningLinjeMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/5',
            where: "OverlatelseID = " + overlatelseID,
            style: belastningMapStyleLine(this),

        });//.addTo(map);


        //---------------------------------- tomt ------------------------------------


        //---------------------------------- tomt Punkt ------------------------------------
        var tomtPunktMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/0',
            where: "OverlatelseID = " + overlatelseID,
            pointToLayer: function (geojson, latlng) {
                //console.log(latlng);
                //console.log(geojson);
                //console.log(geojson.properties);
                label = String(geojson.properties.lopnummer)
                return L.marker(latlng, {
                    icon: L.divIcon({
                        iconSize: null,
                        className: 'map-marker marker-color-tomt',
                        html: '<div>' + label + '</div>'
                    })
                })
            },
        });//.addTo(map);

        //---------------------------------- tomt yta ------------------------------------
        var tomtYtaMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/6',
            where: "OverlatelseID = " + overlatelseID,
            style: tomtMapStyle(this),
            pane: 'tomt',
        });//.addTo(map);


        //---------------------------------- jakt yta ------------------------------------
        var jaktYtaMapLayer = L.esri.featureLayer({
            url: 'https://karttjanstertest.sveaskog.se/agspublic/rest/services/SFS_Demo/UnderlagForForsaljning/MapServer/11',
            where: "OverlatelseID = " + overlatelseID,
            style: jaktMapStyle(this),
            pane: 'tomt',
        });//.addTo(map);

 //       //------------------Zoomar till lable----------------
//
 //       lableMapLayer.once("load", function (evt) {
 //           // create a new empty Leaflet bounds object
 //           var bounds = L.latLngBounds([]);
 //           // loop through the features returned by the server
 //           lableMapLayer.eachFeature(function (layer) {
 //               // get the bounds of an individual feature
 //               var layerBounds = layer.getBounds();
 //               // extend the bounds of the collection to fit the bounds of the new feature
 //               bounds.extend(layerBounds);
 //           });
 //           // once we've looped through all the features, zoom the map to the extent of the collection
 //           map.fitBounds(bounds);
 //       });

        //------------------Zoomar till Övarlåtelsen----------------

        overlatelseMapLayer.once("load", function (evt) {
            // create a new empty Leaflet bounds object
            var bounds = L.latLngBounds([]);
            // loop through the features returned by the server
            overlatelseMapLayer.eachFeature(function (layer) {
                // get the bounds of an individual feature
                var layerBounds = layer.getBounds();
                // extend the bounds of the collection to fit the bounds of the new feature
                bounds.extend(layerBounds);
            });
            // once we've looped through all the features, zoom the map to the extent of the collection
            map.fitBounds(bounds);
        });



        //----------------------------------------- Skapar lagergrupper ------------------------
        var ortoLayerGroup = L.layerGroup([wmsOrtoLayer]);//.addTo(map);

        var avdLayerGroup = L.layerGroup([agoslagMapLayer]);//.addTo(map);
        var lableLayerGroup = L.layerGroup([lableMapLayer]).addTo(map);
        var fastgransLayerGroup = L.layerGroup([fastighetYtaMapLayer]);
        var tomtLayerGroup = L.layerGroup([tomtPunktMapLayer, tomtYtaMapLayer]);//.addTo(map);
        var belastningLayerGroup = L.layerGroup([belastningYtaMapLayer, belastingPunktMapLayer, belastningLinjeMapLayer]);//.addTo(map);
        var overlatelseLayerGroup = L.layerGroup([overlatelseMapLayer]).addTo(map);
        var rattighetLayerGroup = L.layerGroup([rattighetPunktMapLayer, ratighetLinjeMapLayer, rattighetYtaMapLayer]);//.addTo(map);
        var byggnadLayerGroup = L.layerGroup([byggnadPunktMapLayer]);//.addTo(map);
        var jaktLayerGroup = L.layerGroup([jaktYtaMapLayer]);//.addTo(map);
        var wmsFstLayerGroup = L.layerGroup([wmsFstLayer]);

        var overlayMaps = {
            "Överltelse": overlatelseLayerGroup,
            "Etiketter": lableLayerGroup,
            "Avdelningar": avdLayerGroup,
            "Fastighetsgräns": fastgransLayerGroup,
            "Belastningar": belastningLayerGroup,
            "Rättighet": rattighetLayerGroup,
            "Jaktupplåtelse": jaktLayerGroup,
            "Tomt": tomtLayerGroup,
            "Byggnad": byggnadLayerGroup,
            "Fastighet-Metria":wmsFstLayerGroup,

        };


        var baseMaps = {
            "Open Street Map": osm,
            "Bakgrund": wmsMetriaBakgrundLayer,
            "Orto": wmsOrtoLayer,
            
        };

        L.control.layers(baseMaps, overlayMaps).addTo(map);
        L.control.scale({
            imperial: false
        }).addTo(map);



        //----------------------- Popup med koordinater vid klick i kartan ---------------------------
        var popup = L.popup();
        function onMapClick(e) {
            var swerefproj = "+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";
            console.log(e);
            var swerefcoords = proj4(swerefproj, [e.latlng.lng, e.latlng.lat]);
            //console.log(swerefcoords);
            //console.log(e.latlng);
            //console.log(swerefcoords[1]);
            popup
                .setLatLng(e.latlng)
                .setContent("E: " + swerefcoords[0].toString().substring(0, 6) + '<br/>' + "N: " + swerefcoords[1].toString().substring(0, 7))
                .openOn(map);
        };
        map.on('click', onMapClick);

        //----------------------- Bounding box koordinater ---------------------------
        //var popup2 = L.popup();
        function boundingBoxCoordinat(e) {
            var swerefproj = "+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";
            console.log(e);
            var bounds = map.getBounds();
            console.log(bounds);
            var northEastSwerefcoords = proj4(swerefproj, [bounds._northEast.lng, bounds._northEast.lat]);
            var southWestSwerefcoords = proj4(swerefproj, [bounds._southWest.lng, bounds._southWest.lat]);
            console.log(northEastSwerefcoords);
            console.log(southWestSwerefcoords);
            document.getElementById('northWest').innerHTML = "E:" + southWestSwerefcoords[0].toString().substring(0, 6) + " N:" + northEastSwerefcoords[1].toString().substring(0, 7);
            document.getElementById('northEast').innerHTML = "E:" + northEastSwerefcoords[0].toString().substring(0, 6) + " N:" + northEastSwerefcoords[1].toString().substring(0, 7);
            document.getElementById('southWest').innerHTML = "E:" + southWestSwerefcoords[0].toString().substring(0, 6) + " N:" + southWestSwerefcoords[1].toString().substring(0, 7);
            document.getElementById('southEast').innerHTML = "E:" + northEastSwerefcoords[0].toString().substring(0, 6) + " N:" + southWestSwerefcoords[1].toString().substring(0, 7);
        //    //console.log(e.latlng);
        //    //console.log(swerefcoords[1]);
        //    popup2
        //        .setLatLng(e.latlng)
        //        .setContent("X: " + swerefcoords[0].toString().substring(0, 6) + '<br/>' + "Y: " + swerefcoords[1].toString().substring(0, 6))
        //        .openOn(map);
        };
        map.on('moveend', boundingBoxCoordinat);

       // map.on('moveend', function() { 
       //                 var bounds = map.getBounds();
       //     console.log(bounds);
       //     alert(map.getBounds());
       // });

        //------------------------------Funktioner för att sätta mapstyle för olika lager-------------------------
        function fastighetMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {
                fillColor: null,
                weight: 3,
                opacity: 1,
                color: 'black',
                dashArray: 10,
                fillOpacity: 0.0
            }
        }

        function overlatelseMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {
                fillColor: null,
                weight: 5,
                opacity: 1,
                color: 'red',
                //dashArray: 10,
                fillOpacity: 0.0
            }
        }

        function agoslagMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {
                fillColor: null,
                weight: 1,
                opacity: 1,
                color: 'black',
                dashArray: 3,
                fillOpacity: 0.0
            }
        }

        function rattighetMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {

                fillColor: '#00c5ff',
                weight: 3,
                opacity: 1,
                color: '#00c5ff',
                dashArray: 3,
                fillOpacity: 0.5
            }
        }

        function belastningMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {

                fillColor: '#e69900',
                //fillColor: 'white',
                weight: 3,
                opacity: 1,
                //color: '#e69900',
                color: 'white',
                dashArray: "20, 10, 10, 10",
                //dashArray: "5, 20, 5, 10",
                fillOpacity: 0.5
            }
        }

        function belastningMapStyleLine(feature, fillcolor) {
            //console.log('hej')
            return {

                //fillColor: '#e69900',
                //fillColor: 'white',
                weight: 3,
                opacity: 1,
                color: '#e69900',
                //color: 'white',
                dashArray: "20, 10, 10, 10",
                //dashArray: "5, 20, 5, 10",
                fillOpacity: 0.8
            }
        }

        function tomtMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {
                fillColor: '#734c00',
                weight: 3,
                opacity: 1,
                color: '#734c00',
                dashArray: 3,
                fillOpacity: 0.5
            }
        }

        function jaktMapStyle(feature, fillcolor) {
            //console.log('hej')
            return {
                fillColor: '#990099',
                weight: 3,
                opacity: 1,
                color: '#734c00',
                dashArray: 3,
                fillOpacity: 0.5
            }
        }        

        //-------------------- olika ikoner -------------------------------------
        var tomtIcon = L.icon({
            iconUrl: 'src/arrow-down.svg',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            //popupAnchor: [-3, -76],
            //shadowUrl: 'my-icon-shadow.png',
            //shadowSize: [68, 95],
            //shadowAnchor: [22, 94],
            //html: "<span style='color:blue;'>textToDisplay</span>",
        })

        //---------------------- Hämtar överlåtelseid från url parameter eller uppmanar användare att ange id -------------------------------
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) { return pair[1]; }
            }
            return (false);
        }

        //----- en funktion för att skapa tabell------
        function addToTabell(properties, lager, ylp) {
            var Data = '';
            Data += '<tr id="' + lager + '_' + ylp +'_tabellrad">';
            Data += '<td>' + properties.lopnummer + '</td>';
            Data += '<td>' + lager + '</td>';
            Data += '<td>' + properties.Benamning + '</td>';
            Data += '<td>' + ylp + '</td>';
            Data += '</tr>';
            console.log(Data);
            $('#Tabell').append(Data);
        }

        //----- en funktion för att skapa tabell upplåtelse------
        function addToTabellUppl(properties, lager, ylp) {
            var Data = '';
            Data += '<tr id="' + lager + '_' + ylp +'_tabellrad">';
            Data += '<td>' + properties.lopnummer + '</td>';
            Data += '<td>' + lager + '</td>';
            Data += '<td>' + properties.OBJ_NAMN + ' : ' + properties.JAKTKLASS_NAMN + ' : ' + properties.OBJEKT_STATUS_NAMN + '</td>';
            Data += '<td>' + ylp + '</td>';
            Data += '</tr>';
            console.log(Data);
            $('#Tabell').append(Data);
        }

        //-------------- tabort rader-------------------------------
        function deleteRow(rowid)  
            {   
                var row = document.getElementById(rowid);
                row.parentElement.removeChild(row);
            }

        //----------------------------- sortera tabell -----------------------------------------------------
        function sortTables() {
            sortTableLopnummer("Tabell");
        }

        function sortTableLopnummer(tabellNamn) {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById(tabellNamn);
            switching = true;
            /*Make a loop that will continue until
            no switching has been done:*/
            while (switching) {
                //start by saying: no switching is done:
                switching = false;
                rows = table.rows;
                /*Loop through all table rows (except the
                first, which contains table headers):*/
                for (i = 1; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;
                /*Get the two elements you want to compare,
                one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("td")[0];
                y = rows[i + 1].getElementsByTagName("td")[0];
                //check if the two rows should switch place:
                if (Number(x.innerHTML) > Number(y.innerHTML)) {
                    //if so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
                }
                if (shouldSwitch) {
                /*If a switch has been marked, make the switch
                and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                }
            }
            }

            function sortTable(n, tabellNamn) {
                var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                table = document.getElementById("Tabell");
                switching = true;
                // Set the sorting direction to ascending:
                dir = "asc"; 
                /* Make a loop that will continue until
                no switching has been done: */
                while (switching) {
                    // Start by saying: no switching is done:
                    switching = false;
                    rows = table.rows;
                    /* Loop through all table rows (except the
                    first, which contains table headers): */
                    for (i = 1; i < (rows.length - 1); i++) {
                    // Start by saying there should be no switching:
                    shouldSwitch = false;
                    /* Get the two elements you want to compare,
                    one from current row and one from the next: */
                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];
                    /* Check if the two rows should switch place,
                    based on the direction, asc or desc: */
                    if (dir == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                        }
                    } else if (dir == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                        }
                    }
                    }
                    if (shouldSwitch) {
                    /* If a switch has been marked, make the switch
                    and mark that a switch has been done: */
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    // Each time a switch is done, increase this count by 1:
                    switchcount ++; 
                    } else {
                    /* If no switching has been done AND the direction is "asc",
                    set the direction to "desc" and run the while loop again. */
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                    }
                }
                }
    </script>
</body>

</html>